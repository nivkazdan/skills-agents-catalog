---
name: {{ company }}-security-basics
description: |
  Apply {{ display_name }} security best practices for secrets and access control.
  Use when securing API keys, implementing least privilege access,
  or auditing {{ display_name }} security configuration.
  Trigger with phrases like "{{ company }} security", "{{ company }} secrets",
  "secure {{ company }}", "{{ company }} API key security".
allowed-tools: Read, Write, Grep
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} Security Basics

## Overview
Security best practices for {{ display_name }} API keys, tokens, and access control.

## Prerequisites
- {{ display_name }} SDK installed
- Understanding of environment variables
- Access to {{ display_name }} dashboard

## Instructions

### Step 1: Configure Environment Variables
```bash
# .env (NEVER commit to git)
{{ company | upper }}_API_KEY=sk_live_***
{{ company | upper }}_SECRET=***

# .gitignore
.env
.env.local
.env.*.local
```

### Step 2: Implement Secret Rotation
```bash
# 1. Generate new key in {{ display_name }} dashboard
# 2. Update environment variable
export {{ company | upper }}_API_KEY="new_key_here"

# 3. Verify new key works
curl -H "Authorization: Bearer ${{ '{' }}{{ company | upper }}_API_KEY}" \
  {{ api_url | default('https://api.' + company + '.com') }}/health

# 4. Revoke old key in dashboard
```

### Step 3: Apply Least Privilege
| Environment | Recommended Scopes |
|-------------|-------------------|
| Development | `{{ dev_scopes | default('read:*') }}` |
| Staging | `{{ staging_scopes | default('read:*, write:limited') }}` |
| Production | `{{ prod_scopes | default('Only required scopes') }}` |

## Output
- Secure API key storage
- Environment-specific access controls
- Audit logging enabled

## Error Handling
| Security Issue | Detection | Mitigation |
|----------------|-----------|------------|
| Exposed API key | Git scanning | Rotate immediately |
| Excessive scopes | Audit logs | Reduce permissions |
| Missing rotation | Key age check | Schedule rotation |

## Examples

### Service Account Pattern
```typescript
const clients = {
  reader: new {{ client_class | default(display_name + 'Client') }}({
    apiKey: process.env.{{ company | upper }}_READ_KEY,
  }),
  writer: new {{ client_class | default(display_name + 'Client') }}({
    apiKey: process.env.{{ company | upper }}_WRITE_KEY,
  }),
};
```

### Webhook Signature Verification
```typescript
import crypto from 'crypto';

function verifyWebhookSignature(
  payload: string, signature: string, secret: string
): boolean {
  const expected = crypto.createHmac('sha256', secret).update(payload).digest('hex');
  return crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expected));
}
```

### Security Checklist
- [ ] API keys in environment variables
- [ ] `.env` files in `.gitignore`
- [ ] Different keys for dev/staging/prod
- [ ] Minimal scopes per environment
- [ ] Webhook signatures validated
- [ ] Audit logging enabled

### Audit Logging
```typescript
interface AuditEntry {
  timestamp: Date;
  action: string;
  userId: string;
  resource: string;
  result: 'success' | 'failure';
  metadata?: Record<string, any>;
}

async function auditLog(entry: Omit<AuditEntry, 'timestamp'>): Promise<void> {
  const log: AuditEntry = { ...entry, timestamp: new Date() };

  // Log to {{ display_name }} analytics
  await {{ company }}Client.track('audit', log);

  // Also log locally for compliance
  console.log('[AUDIT]', JSON.stringify(log));
}

// Usage
await auditLog({
  action: '{{ company }}.api.call',
  userId: currentUser.id,
  resource: '/v1/resource',
  result: 'success',
});
```

## Resources
- [{{ display_name }} Security Guide]({{ docs_url | default('https://docs.' + company + '.com') }}/security)
- [{{ display_name }} API Scopes]({{ docs_url | default('https://docs.' + company + '.com') }}/scopes)

## Next Steps
For production deployment, see `{{ company }}-prod-checklist`.
