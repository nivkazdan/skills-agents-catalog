---
name: {{ company }}-sdk-patterns
description: |
  Apply production-ready {{ display_name }} SDK patterns for TypeScript and Python.
  Use when implementing {{ display_name }} integrations, refactoring SDK usage,
  or establishing team coding standards for {{ display_name }}.
  Trigger with phrases like "{{ company }} SDK patterns", "{{ company }} best practices",
  "{{ company }} code patterns", "idiomatic {{ company }}".
allowed-tools: Read, Write, Edit
version: 1.0.0
license: MIT
author: Jeremy Longshore <jeremy@intentsolutions.io>
---

# {{ display_name }} SDK Patterns

## Overview
Production-ready patterns for {{ display_name }} SDK usage in TypeScript and Python.

## Prerequisites
- Completed `{{ company }}-install-auth` setup
- Familiarity with async/await patterns
- Understanding of error handling best practices

## Instructions

### Step 1: Implement Singleton Pattern (Recommended)
```typescript
// src/{{ company }}/client.ts
import { {{ client_class | default(display_name + 'Client') }} } from '{{ npm_package | default(company + '-sdk') }}';

let instance: {{ client_class | default(display_name + 'Client') }} | null = null;

export function get{{ display_name }}Client(): {{ client_class | default(display_name + 'Client') }} {
  if (!instance) {
    instance = new {{ client_class | default(display_name + 'Client') }}({
      apiKey: process.env.{{ company | upper }}_API_KEY!,
      {{ client_options | default('// Additional options') }}
    });
  }
  return instance;
}
```

### Step 2: Add Error Handling Wrapper
```typescript
import { {{ error_class | default(display_name + 'Error') }} } from '{{ npm_package | default(company + '-sdk') }}';

async function safe{{ display_name }}Call<T>(
  operation: () => Promise<T>
): Promise<{ data: T | null; error: Error | null }> {
  try {
    const data = await operation();
    return { data, error: null };
  } catch (err) {
    if (err instanceof {{ error_class | default(display_name + 'Error') }}) {
      console.error({
        code: err.code,
        message: err.message,
      });
    }
    return { data: null, error: err as Error };
  }
}
```

### Step 3: Implement Retry Logic
```typescript
async function withRetry<T>(
  operation: () => Promise<T>,
  maxRetries = 3,
  backoffMs = 1000
): Promise<T> {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (err) {
      if (attempt === maxRetries) throw err;
      const delay = backoffMs * Math.pow(2, attempt - 1);
      await new Promise(r => setTimeout(r, delay));
    }
  }
  throw new Error('Unreachable');
}
```

## Output
- Type-safe client singleton
- Robust error handling with structured logging
- Automatic retry with exponential backoff
- Runtime validation for API responses

## Error Handling
| Pattern | Use Case | Benefit |
|---------|----------|---------|
| Safe wrapper | All API calls | Prevents uncaught exceptions |
| Retry logic | Transient failures | Improves reliability |
| Type guards | Response validation | Catches API changes |
| Logging | All operations | Debugging and monitoring |

## Examples

### Factory Pattern (Multi-tenant)
```typescript
const clients = new Map<string, {{ client_class | default(display_name + 'Client') }}>();

export function getClientForTenant(tenantId: string): {{ client_class | default(display_name + 'Client') }} {
  if (!clients.has(tenantId)) {
    const apiKey = getTenantApiKey(tenantId);
    clients.set(tenantId, new {{ client_class | default(display_name + 'Client') }}({ apiKey }));
  }
  return clients.get(tenantId)!;
}
```

### Python Context Manager
```python
from contextlib import asynccontextmanager
from {{ pip_package | default(company) }} import {{ client_class | default(display_name + 'Client') }}

@asynccontextmanager
async def get_{{ company }}_client():
    client = {{ client_class | default(display_name + 'Client') }}()
    try:
        yield client
    finally:
        await client.close()
```

### Zod Validation
```typescript
import { z } from 'zod';

const {{ company }}ResponseSchema = z.object({
  id: z.string(),
  status: z.enum(['active', 'inactive']),
  createdAt: z.string().datetime(),
});
```

## Resources
- [{{ display_name }} SDK Reference]({{ docs_url | default('https://docs.' + company + '.com') }}/sdk)
- [{{ display_name }} API Types]({{ docs_url | default('https://docs.' + company + '.com') }}/types)
- [Zod Documentation](https://zod.dev/)

## Next Steps
Apply patterns in `{{ company }}-core-workflow-a` for real-world usage.
